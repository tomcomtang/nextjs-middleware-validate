(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{3786:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useIntersection",{enumerable:!0,get:function(){return u}});let n=r(4232),l=r(3273),i="function"==typeof IntersectionObserver,s=new Map,o=[];function u(e){let{rootRef:t,rootMargin:r,disabled:u}=e,c=u||!i,[d,a]=(0,n.useState)(!1),f=(0,n.useRef)(null),h=(0,n.useCallback)(e=>{f.current=e},[]);return(0,n.useEffect)(()=>{if(i){if(c||d)return;let e=f.current;if(e&&e.tagName)return function(e,t,r){let{id:n,observer:l,elements:i}=function(e){let t,r={root:e.root||null,margin:e.rootMargin||""},n=o.find(e=>e.root===r.root&&e.margin===r.margin);if(n&&(t=s.get(n)))return t;let l=new Map;return t={id:r,observer:new IntersectionObserver(e=>{e.forEach(e=>{let t=l.get(e.target),r=e.isIntersecting||e.intersectionRatio>0;t&&r&&t(r)})},e),elements:l},o.push(r),s.set(r,t),t}(r);return i.set(e,t),l.observe(e),function(){if(i.delete(e),l.unobserve(e),0===i.size){l.disconnect(),s.delete(n);let e=o.findIndex(e=>e.root===n.root&&e.margin===n.margin);e>-1&&o.splice(e,1)}}}(e,e=>e&&a(e),{root:null==t?void 0:t.current,rootMargin:r})}else if(!d){let e=(0,l.requestIdleCallback)(()=>a(!0));return()=>(0,l.cancelIdleCallback)(e)}},[c,r,t,d,f.current]),[h,d,(0,n.useCallback)(()=>{a(!1)},[])]}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4009:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return _},useLinkStatus:function(){return v}});let n=r(8365),l=r(7876),i=n._(r(4232)),s=r(4727),o=r(1623),u=r(170),c=r(464),d=r(125),a=r(242),f=r(3786),h=r(4327),p=r(9094),j=r(9203);r(5785);let x=new Set;function y(e,t,r,n){if((0,o.isLocalURL)(t)){if(!n.bypassPrefetchedCheck){let l=t+"%"+r+"%"+(void 0!==n.locale?n.locale:"locale"in e?e.locale:void 0);if(x.has(l))return;x.add(l)}e.prefetch(t,r,n).catch(e=>{})}}function g(e){return"string"==typeof e?e:(0,u.formatUrl)(e)}let m=i.default.forwardRef(function(e,t){let r,n,{href:u,as:x,children:m,prefetch:b=null,passHref:v,replace:_,shallow:M,scroll:C,locale:O,onClick:P,onNavigate:k,onMouseEnter:w,onTouchStart:E,legacyBehavior:N=!1,...R}=e;r=m,N&&("string"==typeof r||"number"==typeof r)&&(r=(0,l.jsx)("a",{children:r}));let S=i.default.useContext(a.RouterContext),T=!1!==b,{href:A,as:L}=i.default.useMemo(()=>{if(!S){let e=g(u);return{href:e,as:x?g(x):e}}let[e,t]=(0,s.resolveHref)(S,u,!0);return{href:e,as:x?(0,s.resolveHref)(S,x):t||e}},[S,u,x]),I=i.default.useRef(A),D=i.default.useRef(L);N&&(n=i.default.Children.only(r));let U=N?n&&"object"==typeof n&&n.ref:t,[H,K,B]=(0,f.useIntersection)({rootMargin:"200px"}),z=i.default.useCallback(e=>{(D.current!==L||I.current!==A)&&(B(),D.current=L,I.current=A),H(e)},[L,A,B,H]),F=(0,j.useMergedRef)(z,U);i.default.useEffect(()=>{S&&K&&T&&y(S,A,L,{locale:O})},[L,A,K,O,T,null==S?void 0:S.locale,S]);let X={ref:F,onClick(e){N||"function"!=typeof P||P(e),N&&n.props&&"function"==typeof n.props.onClick&&n.props.onClick(e),S&&(e.defaultPrevented||function(e,t,r,n,l,i,s,u,c){let{nodeName:d}=e.currentTarget;if(!("A"===d.toUpperCase()&&function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||e.currentTarget.hasAttribute("download"))){if(!(0,o.isLocalURL)(r)){l&&(e.preventDefault(),location.replace(r));return}e.preventDefault(),(()=>{if(c){let e=!1;if(c({preventDefault:()=>{e=!0}}),e)return}let e=null==s||s;"beforePopState"in t?t[l?"replace":"push"](r,n,{shallow:i,locale:u,scroll:e}):t[l?"replace":"push"](n||r,{scroll:e})})()}}(e,S,A,L,_,M,C,O,k))},onMouseEnter(e){N||"function"!=typeof w||w(e),N&&n.props&&"function"==typeof n.props.onMouseEnter&&n.props.onMouseEnter(e),S&&y(S,A,L,{locale:O,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(e){N||"function"!=typeof E||E(e),N&&n.props&&"function"==typeof n.props.onTouchStart&&n.props.onTouchStart(e),S&&y(S,A,L,{locale:O,priority:!0,bypassPrefetchedCheck:!0})}};if((0,c.isAbsoluteUrl)(L))X.href=L;else if(!N||v||"a"===n.type&&!("href"in n.props)){let e=void 0!==O?O:null==S?void 0:S.locale;X.href=(null==S?void 0:S.isLocaleDomain)&&(0,h.getDomainLocale)(L,e,null==S?void 0:S.locales,null==S?void 0:S.domainLocales)||(0,p.addBasePath)((0,d.addLocale)(L,e,null==S?void 0:S.defaultLocale))}return N?i.default.cloneElement(n,X):(0,l.jsx)("a",{...R,...X,children:r})}),b=(0,i.createContext)({pending:!1}),v=()=>(0,i.useContext)(b),_=m;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4327:(e,t,r)=>{"use strict";function n(e,t,r,n){return!1}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getDomainLocale",{enumerable:!0,get:function(){return n}}),r(9783),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},5668:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(7876),l=r(7328),i=r.n(l),s=r(8230),o=r.n(s);let u=()=>(0,n.jsxs)("div",{children:[(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:"Next.js 15 Middleware 验证"}),(0,n.jsx)("meta",{name:"description",content:"Next.js 15.x 中间件验证页面（Node.js runtime）"})]}),(0,n.jsxs)("main",{style:{padding:"2rem",fontFamily:"system-ui"},children:[(0,n.jsx)("h1",{children:"Next.js 15.x Middleware 验证"}),(0,n.jsxs)("section",{style:{marginTop:"2rem"},children:[(0,n.jsx)("h2",{children:"测试场景"}),(0,n.jsx)("h3",{children:"1. 基础功能"}),(0,n.jsxs)("ul",{style:{listStyle:"none",padding:0},children:[(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/api/test",children:"/api/test - 测试 API 路由和响应头"})}),(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/about",children:"/about - 测试请求重写（重写到 /about-us）"})})]}),(0,n.jsx)("h3",{children:"2. 认证和授权"}),(0,n.jsxs)("ul",{style:{listStyle:"none",padding:0},children:[(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/admin/dashboard",children:"/admin/dashboard - Cookie 认证（无 session 应重定向）"})}),(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/protected/dashboard",children:"/protected/dashboard - Header 认证（无 Authorization 应重定向）"})})]}),(0,n.jsx)("h3",{children:"3. 请求头修改"}),(0,n.jsx)("ul",{style:{listStyle:"none",padding:0},children:(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/api/test",children:"/api/test - 查看中间件修改的请求头（在 JSON 响应中）"})})}),(0,n.jsx)("h3",{children:"4. 其他功能"}),(0,n.jsxs)("ul",{style:{listStyle:"none",padding:0},children:[(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/api/test?preview=true",children:"/api/test?preview=true - 测试查询参数处理"})}),(0,n.jsx)("li",{style:{margin:"0.5rem 0"},children:(0,n.jsx)(o(),{href:"/api/secure/test",children:"/api/secure/test - 测试请求验证（需要 x-api-key header）"})})]})]}),(0,n.jsxs)("section",{style:{marginTop:"2rem"},children:[(0,n.jsx)("h2",{children:"版本信息"}),(0,n.jsx)("p",{children:"Next.js 版本: 15.x"}),(0,n.jsx)("p",{children:"Middleware 文件: middleware.ts"}),(0,n.jsxs)("p",{children:["Runtime: ",(0,n.jsx)("strong",{children:"Edge"})," (边缘平台只支持 Edge runtime)"]}),(0,n.jsx)("p",{children:"注意: 边缘平台会将 Edge runtime 中间件打包到 Edge Functions"}),(0,n.jsx)("p",{children:"新特性: 增强的 Edge runtime 功能，userAgent helper，改进的 Cookies API"})]}),(0,n.jsxs)("section",{style:{marginTop:"2rem"},children:[(0,n.jsx)("h2",{children:"测试说明"}),(0,n.jsx)("p",{children:"打开浏览器开发者工具，查看 Network 标签页中的响应头："}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-middleware-version"}),": v15"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-runtime"}),": experimental-edge"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-ab-test-variant"}),": variant-a 或 variant-b（A/B 测试）"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-preferred-lang"}),": 检测到的语言"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-country"}),": 检测到的国家（如果可用）"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"x-theme"}),": 当前主题"]})]}),(0,n.jsx)("h3",{children:"中间件功能列表"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"✅ 认证和授权（Cookie/Header）"}),(0,n.jsx)("li",{children:"✅ 请求重定向"}),(0,n.jsx)("li",{children:"✅ 请求重写"}),(0,n.jsx)("li",{children:"✅ A/B 测试"}),(0,n.jsx)("li",{children:"✅ 多语言检测"}),(0,n.jsx)("li",{children:"✅ 地理位置检测"}),(0,n.jsx)("li",{children:"✅ 主题切换"}),(0,n.jsx)("li",{children:"✅ User-Agent 检测"}),(0,n.jsx)("li",{children:"✅ Cookie 操作"}),(0,n.jsx)("li",{children:"✅ 请求头修改"}),(0,n.jsx)("li",{children:"✅ 响应头设置"}),(0,n.jsx)("li",{children:"✅ 查询参数处理"}),(0,n.jsx)("li",{children:"✅ 缓存控制"}),(0,n.jsx)("li",{children:"✅ 请求验证"})]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"注意"}),": 此版本配置为 Edge runtime，适用于边缘平台。"]})]})]})]})},5785:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"errorOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(5668)}])},7328:(e,t,r)=>{e.exports=r(9269)},8230:(e,t,r)=>{e.exports=r(4009)},9203:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return l}});let n=r(4232);function l(e,t){let r=(0,n.useRef)(null),l=(0,n.useRef)(null);return(0,n.useCallback)(n=>{if(null===n){let e=r.current;e&&(r.current=null,e());let t=l.current;t&&(l.current=null,t())}else e&&(r.current=i(e,n)),t&&(l.current=i(t,n))},[e,t])}function i(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);